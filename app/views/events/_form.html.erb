<%= form_for(@event) do |f| %>
  <%= render "shared/error_messages", :target => @event %>

  <section>
    <div class='form-group'>
      <%= f.label :url %>
      <%= f.text_field :url %>
    </div>

    <div class='form-group'>
      <%= f.label :venue_id, 'Venue' %>
      <%= f.select :venue_id, venue_select, {:include_blank => true} %>
    </div>
    <div class='form-group'>
      <%= f.label :event_type %>
      <%= f.select :event_type, event_type_select, {:include_blank => true} %>
    </div>
  </section>

  <% if @event.persisted? %>
    <section data-controller="organiser-link">
      <h3 class='form-group-title'>Organiser edit link</h3>
      <p id='organiser-token' data-organiser-link-target="source" >
        <% if @event.organiser_token %>
          <%= edit_external_event_url(@event.organiser_token) %>
        <% else %>
          No organiser edit link exists for this event
        <% end %>
      </p>
      <p class='help'>This is a link you can share with an organiser to allow them to add dates and change details</p>
      <% if @event.organiser_token %>
        <a href="#" class="button button-smaller" data-action="click->organiser-link#copy">Copy</a>
      <% end %>
      <%= link_to(
        'Generate link',
        event_organiser_tokens_path(@event),
        method: :post,
        remote: true,
        data: { confirm: "Are you sure you want to create a new link? This will invalidate the previous link" },
        class: class_names('button', 'button-smaller', { "button-danger": @event.organiser_token }))
      %>
    </section>
  <% end %>

  <section>
    <h3 class='form-group-title'>Social details</h3>
    <div class='form-group'>
      <%= f.label :has_social, "Has social?" %>
      <%= f.check_box :has_social  %>
      <span class='help'>Events with a social dance *must* have a title: this is what gets displayed in the listing</span>
    </div>
    <div class='form-group'>
      <%= f.label :title %>
      <%= f.text_field :title %>
    </div>
    <div class='form-group'>
      <%= f.label :social_organiser_id, 'Social organiser' %>
      <%= f.select :social_organiser_id, organiser_select, { include_blank: '(none)' } %>
    </div>
  </section>

  <section>
    <h3 class='form-group-title'>Class details</h3>
    <div class='form-group'>
      <%= f.label :has_class, "Has a class?" %>
      <%= f.check_box :has_class  %>
      <span class='help'>Events with a class *must* have a class organiser</span>
    </div>
    <div class='form-group'>
      <%= f.label :has_taster, "Has a taster?" %>
      <%= f.check_box :has_taster  %>
    </div>
    <div class='form-group'>
      <%= f.label :class_organiser_id, 'Class organiser' %>
      <%= f.select :class_organiser_id, organiser_select, { include_blank: '(none)' } %>
      <p class='help'>Note: classes don't have names - just locations and organisers</p>
      <p class='help'>The location and organiser name are displayed in the listings.</>
    </div>

    <h4 class='form-subgroup-title'>Class style</h3>
    <div class='form-subgroup' id="class-style-selection">
      <div class='radio-group'>
        <%= radio_button_tag 'class_style_option', 'lindy', @event.class_style.blank? %>
        <%= label_tag :class_style_option_lindy, t('forms.events.default_class_style') %>
      </div>
      <div class='radio-group'>
        <%= radio_button_tag 'class_style_option', 'other', !@event.class_style.blank?, data: { target: 'class-style-group' }%>
        <%= label_tag 'class_style_option_other', 'Other (balboa, shag etc)' %>
      </div>
      <div class='form-group form-group-nested <%= 'hidden' if @event.class_style.blank? %>' id="class-style-group">
        <%= f.label :class_style, "Dance style:" %>
        <%= f.text_field :class_style %>
      </div>
    </div>
    <div class='form-group'>
      <%= f.label :course_length %>
      <%= f.text_field :course_length, :size => 2, :class =>"shortfield" %> weeks
    </div>
  </section>

  <section>
    <h3 class='form-group-title'>When?</h3>
    <div class='form-group'>
      <%= f.label :day %>
      <%= f.select :day, DAYNAMES %>
    </div>
    <div class='form-group'>
      <%= f.label :frequency %>
      <p class='help'>For one-off or intermittent events, use 0</p>
      every <%= f.text_field :frequency, :size => 2, :class =>"shortfield" %> weeks
    </div>
    <div class='form-group'>
      <%= f.label :date_array, 'Upcoming dates' %>
      <p class='help'><%= t('forms.help.dates') %></p>
      <%= f.text_field :date_array, :value => @event.print_dates %>
    </div>
    <div class='form-group'>
      <%= f.label :cancellation_array, 'Cancelled dates' %>
      <p class='help'><%= t('forms.help.dates') %></p>
      <%= f.text_field :cancellation_array, :value => @event.print_cancellations %>
    </div>
    <div class='form-group'>
      <%= f.label :first_date %>
      <p class='help'>The event will only be included in the listings from this date forwards.</p>
      <p class='help'>
        A <span class="new-label">NEW!</span> label will be shown on the listing
        for <%= distance_of_time_in_words(Event::CONSIDERED_NEW_FOR) %> after this date.
      </p>
      <%= f.text_field :first_date, value: @event.first_date.to_s, :size => 10, :class =>"shortfield" %>
    </div>
    <div class='form-group'>
      <%= f.label :last_date %>
      <p class='help'>The event will stop being included in the listings after this date</p>
      <%= f.text_field :last_date, value: @event.last_date.to_s, :size => 10, :class =>"shortfield"%>
    </div>
  </section>

  <div class='form-group actions'>
    <%= f.submit action, class: 'button' %>
    <%= link_to 'Cancel', cancel_path, class: "button button-secondary" %>
  </div>
<% end %>
